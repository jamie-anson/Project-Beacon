[build]
  # Use the proven package.json build scripts instead of complex bash
  command = "npm run build:netlify"
  publish = "dist"

[build.environment]
  NODE_VERSION = "20"
  NPM_FLAGS = "--no-audit --fund=false --legacy-peer-deps"
  # Increase memory for Node.js builds
  NODE_OPTIONS = "--max-old-space-size=4096"
  # Default IPFS gateway for production portal links (overridable per-deploy)
  VITE_IPFS_GATEWAY = "https://ipfs.io"
  # WebSocket client disabled by default (no WS server running)
  VITE_ENABLE_WS = "0"
  # Use same-origin for API base; portal code appends /api/v1
  VITE_API_BASE = "https://projectbeacon.netlify.app"
  # Route diffs via site-relative proxy (managed in dist/_redirects)
  VITE_DIFFS_BASE = "/backend-diffs"
  # If needed, set these in Netlify UI instead of hardcoding:
  # VITE_HYBRID_BASE = "https://project-beacon-production.up.railway.app"
  # VITE_WS_BASE = "wss://project-beacon-production.up.railway.app"
  # Google Maps API key is securely stored in Railway backend-diffs service
  # Portal uses proxy endpoint to avoid exposing API key in client-side bundle
  # No VITE_GOOGLE_MAPS_API_KEY needed - handled server-side

# All redirects now handled by dist/_redirects (single source of truth)
# Generated by scripts/write-redirects.js with environment parameterization

# Caching for built assets and security headers
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "SAMEORIGIN"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "geolocation=(), microphone=(), camera=()"
    Strict-Transport-Security = "max-age=63072000; includeSubDomains; preload"
    Content-Security-Policy = "default-src 'self'; img-src 'self' data: https:; font-src 'self' https: data:; script-src 'self' 'unsafe-inline' https://project-beacon-production.up.railway.app https://maps.googleapis.com https://maps.gstatic.com; style-src 'self' 'unsafe-inline' https:; connect-src 'self' https:; frame-ancestors 'self'; referrer 'strict-origin-when-cross-origin'"
